SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
CREATE FUNCTION [dbo].[zf_GetEmpNameForDate](@OurID int, @EmpID int, @Date smalldatetime, @Param varchar(100))/* Возвращает данные об имени служащегоЗначениt @Param (можно указыввать последовательность через пробел, напр. '12 13 14' или '12 15'):       11 Имя служащего      EmpName       12 Фамилия            EmpLastName       13 Имя                EmpFirstName       14 Отчество           EmpParName       15 Инициалы           EmpInitials       21 Укр. имя служащего UAEmpName       22 Укр. фамилия       UAEmpLastName       23 Укр. имя           UAEmpFirstName       24 Укр. отчество      UAEmpParName       25 Укр. инициалы      UAEmpInitials       31 Серия паспорта     PassSer       32 Номер паспорта     PassNo       33 Дата выдачи        PassDate       34 Кем выдан          PassDept */RETURNS varchar(200) ASBEGIN  RETURN (SELECT TOP 1 REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@Param,                       '31', ISNULL(PassSer, '')),                       '32', ISNULL(PassNo, '')),                       '33', ISNULL(CAST(PassDate AS varchar(10)), '')),                       '34', ISNULL(PassDept, '')),                       '25', ISNULL(UAEmpInitials, '')),                       '24', ISNULL(UAEmpParName, '')),                       '23', ISNULL(UAEmpFirstName, '')),                       '22', ISNULL(UAEmpLastName, '')),                       '21', ISNULL(UAEmpName, '')),                       '15', ISNULL(EmpInitials, '')),                       '14', ISNULL(EmpParName, '')),                       '13', ISNULL(EmpFirstName, '')),                       '12', ISNULL(EmpLastName, '')),                       '11', ISNULL(EmpName, ''))          FROM r_EmpNames WHERE OurID = @OurID AND EmpID = @EmpID AND ChDate <= @Date ORDER BY ChDate DESC)END
GO