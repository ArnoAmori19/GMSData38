SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
CREATE FUNCTION [dbo].[zf_MatchFilterInt](@Value int, @FiltStr varchar (4000), @Delim varchar (10))/* Удовлетворяет ли целое значение строке фильтра */RETURNS BIT ASBEGIN  IF ISNULL(@FiltStr, '') = '' RETURN 1  SET @FiltStr = @FiltStr + @Delim  SET @FiltStr = REPLACE(@FiltStr, ' ', '')  WHILE (CHARINDEX(@Delim + @Delim, @FiltStr) > 0) SET @FiltStr = REPLACE(@FiltStr, @Delim + @Delim, @Delim)  DECLARE @i int  DECLARE @j int  DECLARE @k int  DECLARE @s varchar(4000)  DECLARE @start int  DECLARE @stop int  SET @i = 0  WHILE (1 = 1)    BEGIN      SET @i = CHARINDEX(@Delim, @FiltStr)      IF @i < 1 BREAK      SET @s = LTRIM(RTRIM(SUBSTRING(@FiltStr, 1, @i - 1)))      SET @j = CHARINDEX('>=', @s)      SET @k = CHARINDEX('<=', @s)      IF (@j > 0) AND (@value >= CAST(SUBSTRING(@s, 3, LEN(@s) - 2) AS int)) RETURN 1      IF (@k > 0) AND (@value <= CAST(SUBSTRING(@s, 3, LEN(@s) - 2) AS int)) RETURN 1      IF @k + @j = 0        BEGIN          SET @j = CHARINDEX('>', @s)          SET @k = CHARINDEX('<', @s)          IF (@j > 0) AND (@value > CAST(SUBSTRING(@s, 2, LEN(@s) - 1) AS int)) RETURN 1          IF (@k > 0) AND (@value < CAST(SUBSTRING(@s, 2, LEN(@s) - 1) AS int)) RETURN 1        END      IF @k + @j = 0        BEGIN          SET @j = CHARINDEX('-', @s)          IF @j > 0            BEGIN              SET @start = CAST(SUBSTRING(@s, 1, @j - 1) AS int)              SET @stop = CAST(SUBSTRING(@s, @j + 1, LEN(@s)- @j) AS int)            END          ELSE            BEGIN              SET @start = CAST(@s AS int)              SET @stop = @start            END          IF ((@j > 0) AND (@value >= @start AND @value <= @stop)) OR ((@j = 0) AND (@value = @start)) RETURN 1        END      SET @FiltStr = SUBSTRING(@FiltStr, @i + 1, LEN(@FiltStr) - @i)    END  RETURN 0END
GO