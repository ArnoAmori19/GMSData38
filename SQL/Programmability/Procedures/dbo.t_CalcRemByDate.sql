SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
CREATE PROCEDURE [dbo].[t_CalcRemByDate](@BDate smalldatetime, @EDate smalldatetime)AS  BEGIN TRAN  if exists (select * from dbo.sysobjects where id = object_id(CURRENT_USER + '.t_RemD') and xtype in (N'U'))  DROP TABLE t_RemD  SELECT * INTO t_RemD FROM dbo.zf_t_CalcRemByDateDate(@BDate, @EDate)  IF @@ERROR <> 0 GOTO ErrorHandler  CREATE NONCLUSTERED INDEX OurID_StockID_SecID_ProdID_PPID ON t_RemD(OurID, StockID, SecID, ProdID, PPID)  IF @@ERROR <> 0 GOTO ErrorHandler  /* Логирование расчета */  INSERT z_LogAU (AUGroupCode, UserCode, BDate, EDate)  VALUES  (1, dbo.zf_GetUserCode(), @BDate, @EDate)  COMMIT TRAN  RETURN  ErrorHandler:  ROLLBACK TRAN
GO